<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.5"/><style data-href="/styles.66d80875507026e90a2c.css" data-identity="gatsby-global-css">.anagram-swap{align-self:center;color:#fff;display:flex;flex:0 0 auto;flex-direction:column;height:100%;margin:0 auto;padding:0;text-align:left;text-transform:uppercase;width:100%}.anagram-swap,.anagram-swap .word{position:relative}.anagram-swap .word.hidden{left:-1000px;position:absolute;visibility:hidden}.anagram-swap .word .letter{display:inline-block;left:0;position:relative;top:0;transition:left 2s ease-in-out,top 2s ease-in-out;white-space:pre;z-index:10}.vertical-timeline *{box-sizing:border-box}.vertical-timeline{margin:0 auto;max-width:1170px;padding:2em 0;position:relative;width:95%}.vertical-timeline:after{clear:both;content:"";display:table}.vertical-timeline:before{background:var(--line-color);content:"";height:100%;left:18px;position:absolute;top:0;width:4px}.vertical-timeline.vertical-timeline--one-column-right:before{left:unset;right:18px}@media only screen and (min-width:1170px){.vertical-timeline.vertical-timeline--two-columns{width:90%}.vertical-timeline.vertical-timeline--two-columns:before{left:50%;margin-left:-2px}}.vertical-timeline-element{margin:2em 0;position:relative}.vertical-timeline-element>div{min-height:1px}.vertical-timeline-element:after{clear:both;content:"";display:table}.vertical-timeline-element:first-child{margin-top:0}.vertical-timeline-element:last-child{margin-bottom:0}@media only screen and (min-width:1170px){.vertical-timeline-element{margin:4em 0}.vertical-timeline-element:first-child{margin-top:0}.vertical-timeline-element:last-child{margin-bottom:0}}.vertical-timeline-element-icon{border-radius:50%;box-shadow:0 0 0 4px #fff,inset 0 2px 0 rgba(0,0,0,.08),0 3px 0 4px rgba(0,0,0,.05);height:40px;left:0;position:absolute;top:0;width:40px}.vertical-timeline--one-column-right .vertical-timeline-element-icon{left:unset;right:0}.vertical-timeline-element-icon svg{display:block;height:24px;left:50%;margin-left:-12px;margin-top:-12px;position:relative;top:50%;width:24px}@media only screen and (min-width:1170px){.vertical-timeline--two-columns .vertical-timeline-element-icon{height:60px;left:50%;margin-left:-30px;width:60px}}.vertical-timeline-element-icon{-webkit-backface-visibility:hidden;-webkit-transform:translateZ(0)}.vertical-timeline--animate .vertical-timeline-element-icon.is-hidden{visibility:hidden}.vertical-timeline--animate .vertical-timeline-element-icon.bounce-in{-webkit-animation:cd-bounce-1 .6s;animation:cd-bounce-1 .6s;visibility:visible}@-webkit-keyframes cd-bounce-1{0%{opacity:0;-webkit-transform:scale(.5)}60%{opacity:1;-webkit-transform:scale(1.2)}to{-webkit-transform:scale(1)}}@keyframes cd-bounce-1{0%{opacity:0;-webkit-transform:scale(.5);transform:scale(.5)}60%{opacity:1;-webkit-transform:scale(1.2);transform:scale(1.2)}to{-webkit-transform:scale(1);transform:scale(1)}}.vertical-timeline-element-content{background:#fff;border-radius:.25em;box-shadow:0 3px 0 #ddd;margin-left:60px;padding:1em;position:relative}.vertical-timeline--one-column-right .vertical-timeline-element-content{margin-left:unset;margin-right:60px}.vertical-timeline-element--no-children .vertical-timeline-element-content{background:0 0;box-shadow:none}.vertical-timeline-element-content:after{clear:both;content:"";display:table}.vertical-timeline-element-content h2{color:#303e49}.vertical-timeline-element-content .vertical-timeline-element-date,.vertical-timeline-element-content p{font-size:13px;font-size:.8125rem;font-weight:500}.vertical-timeline-element-content .vertical-timeline-element-date{display:inline-block}.vertical-timeline-element-content p{line-height:1.6;margin:1em 0 0}.vertical-timeline-element-subtitle,.vertical-timeline-element-title{margin:0}.vertical-timeline-element-content .vertical-timeline-element-date{float:left;opacity:.7;padding:.8em 0}.vertical-timeline-element-content-arrow{border:7px solid transparent;border-right-color:#fff;content:"";height:0;position:absolute;right:100%;top:16px;width:0}.vertical-timeline--one-column-right .vertical-timeline-element-content-arrow{border:7px solid transparent;border-left-color:#fff;content:"";height:0;left:100%;position:absolute;right:unset;top:16px;width:0}.vertical-timeline--one-column-right .vertical-timeline-element-content:before{border-left:7px solid #fff;border-right:unset;left:100%}.vertical-timeline-element--no-children .vertical-timeline-element-content-arrow,.vertical-timeline-element--no-children .vertical-timeline-element-content:before{display:none}@media only screen and (min-width:768px){.vertical-timeline-element-content h2{font-size:20px;font-size:1.25rem}.vertical-timeline-element-content p{font-size:16px;font-size:1rem}.vertical-timeline-element-content .vertical-timeline-element-date{font-size:14px;font-size:.875rem}}@media only screen and (min-width:1170px){.vertical-timeline--two-columns .vertical-timeline-element-content{margin-left:0;padding:1.5em;width:44%}.vertical-timeline--two-columns .vertical-timeline-element-content-arrow{left:100%;top:24px;-webkit-transform:rotate(180deg);transform:rotate(180deg)}.vertical-timeline--two-columns .vertical-timeline-element-content .vertical-timeline-element-date{font-size:16px;font-size:1rem;left:124%;position:absolute;top:6px;width:100%}.vertical-timeline--two-columns .vertical-timeline-element.vertical-timeline-element--right .vertical-timeline-element-content,.vertical-timeline--two-columns .vertical-timeline-element:nth-child(2n):not(.vertical-timeline-element--left) .vertical-timeline-element-content{float:right}.vertical-timeline--two-columns .vertical-timeline-element.vertical-timeline-element--right .vertical-timeline-element-content-arrow,.vertical-timeline--two-columns .vertical-timeline-element:nth-child(2n):not(.vertical-timeline-element--left) .vertical-timeline-element-content-arrow{left:auto;right:100%;top:24px;-webkit-transform:rotate(0);transform:rotate(0)}.vertical-timeline--one-column-right .vertical-timeline-element.vertical-timeline-element--right .vertical-timeline-element-content-arrow,.vertical-timeline--one-column-right .vertical-timeline-element:nth-child(2n):not(.vertical-timeline-element--left) .vertical-timeline-element-content-arrow{left:100%;right:auto;top:24px;-webkit-transform:rotate(0);transform:rotate(0)}.vertical-timeline--two-columns .vertical-timeline-element.vertical-timeline-element--right .vertical-timeline-element-content .vertical-timeline-element-date,.vertical-timeline--two-columns .vertical-timeline-element:nth-child(2n):not(.vertical-timeline-element--left) .vertical-timeline-element-content .vertical-timeline-element-date{left:auto;right:124%;text-align:right}}.vertical-timeline--animate .vertical-timeline-element-content.is-hidden{visibility:hidden}.vertical-timeline--animate .vertical-timeline-element-content.bounce-in{-webkit-animation:cd-bounce-2 .6s;animation:cd-bounce-2 .6s;visibility:visible}@media only screen and (min-width:1170px){.vertical-timeline--two-columns.vertical-timeline--animate .vertical-timeline-element.vertical-timeline-element--right .vertical-timeline-element-content.bounce-in,.vertical-timeline--two-columns.vertical-timeline--animate .vertical-timeline-element:nth-child(2n):not(.vertical-timeline-element--left) .vertical-timeline-element-content.bounce-in{-webkit-animation:cd-bounce-2-inverse .6s;animation:cd-bounce-2-inverse .6s}}@media only screen and (max-width:1169px){.vertical-timeline--animate .vertical-timeline-element-content.bounce-in{-webkit-animation:cd-bounce-2-inverse .6s;animation:cd-bounce-2-inverse .6s;visibility:visible}}@-webkit-keyframes cd-bounce-2{0%{opacity:0;-webkit-transform:translateX(-100px)}60%{opacity:1;-webkit-transform:translateX(20px)}to{-webkit-transform:translateX(0)}}@keyframes cd-bounce-2{0%{opacity:0;-webkit-transform:translateX(-100px);transform:translateX(-100px)}60%{opacity:1;-webkit-transform:translateX(20px);transform:translateX(20px)}to{-webkit-transform:translateX(0);transform:translateX(0)}}@-webkit-keyframes cd-bounce-2-inverse{0%{opacity:0;-webkit-transform:translateX(100px)}60%{opacity:1;-webkit-transform:translateX(-20px)}to{-webkit-transform:translateX(0)}}@keyframes cd-bounce-2-inverse{0%{opacity:0;-webkit-transform:translateX(100px);transform:translateX(100px)}60%{opacity:1;-webkit-transform:translateX(-20px);transform:translateX(-20px)}to{-webkit-transform:translateX(0);transform:translateX(0)}}@font-face{font-family:Milletun;src:url(/static/Milletun-a8bd31df9a09787f79fc9f07683683d0.otf)}@font-face{font-family:G7;src:url(/static/g7_1943-436ce9e1cf71459005231bc22b7cfb1e.ttf)}@-webkit-keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@-webkit-keyframes fade-out{0%{opacity:1}to{opacity:0}}@keyframes fade-out{0%{opacity:1}to{opacity:0}}@-webkit-keyframes background-fade-in{0%{background-color:#000;scrollbar-color:#000 #000}to{background-color:aqua;scrollbar-color:aqua #000}}@keyframes background-fade-in{0%{background-color:#000;scrollbar-color:#000 #000}to{background-color:aqua;scrollbar-color:aqua #000}}@-webkit-keyframes background-scroll{0%{background-position:0 0}to{background-position:32px 32px}}@keyframes background-scroll{0%{background-position:0 0}to{background-position:32px 32px}}@-webkit-keyframes fade-in-cyan-shadow{0%{text-shadow:1px 1px rgba(0,255,255,0),2px 2px rgba(0,255,255,0),3px 3px rgba(0,255,255,0),4px 4px rgba(0,255,255,0)}to{text-shadow:1px 1px #0ff,2px 2px #0ff,3px 3px #0ff,4px 4px #0ff}}@keyframes fade-in-cyan-shadow{0%{text-shadow:1px 1px rgba(0,255,255,0),2px 2px rgba(0,255,255,0),3px 3px rgba(0,255,255,0),4px 4px rgba(0,255,255,0)}to{text-shadow:1px 1px #0ff,2px 2px #0ff,3px 3px #0ff,4px 4px #0ff}}@-webkit-keyframes scroll-indicator-move{0%{-webkit-transform:translateY(-50%) scaleY(0);transform:translateY(-50%) scaleY(0)}50%{-webkit-transform:translateY(0) scaleY(1);transform:translateY(0) scaleY(1)}to{-webkit-transform:translateY(50%) scaleY(0);transform:translateY(50%) scaleY(0)}}@keyframes scroll-indicator-move{0%{-webkit-transform:translateY(-50%) scaleY(0);transform:translateY(-50%) scaleY(0)}50%{-webkit-transform:translateY(0) scaleY(1);transform:translateY(0) scaleY(1)}to{-webkit-transform:translateY(50%) scaleY(0);transform:translateY(50%) scaleY(0)}}@-webkit-keyframes up-down{0%{-webkit-transform:translateY(-32px);transform:translateY(-32px)}to{-webkit-transform:translateY(32px);transform:translateY(32px)}}@keyframes up-down{0%{-webkit-transform:translateY(-32px);transform:translateY(-32px)}to{-webkit-transform:translateY(32px);transform:translateY(32px)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes scroll{0%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(-160px);transform:translateY(-160px)}}@keyframes scroll{0%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(-160px);transform:translateY(-160px)}}.fung-sim{z-index:-2}.fung-cover,.fung-sim{left:0;position:fixed;top:0}.fung-cover{-webkit-animation:fade-out 6s .5s forwards;animation:fade-out 6s .5s forwards;bottom:0;right:0;z-index:-1}.fung-cover,.fung-html{background-color:#000}.fung-html .container{padding:0}.fung-html body{background-color:transparent;font-family:G7}.fung-html section{background-color:rgba(0,0,0,.8);margin-bottom:3em;margin-top:2em;padding:1em}@media(max-width:767px){.fung-html section{margin:0}}.fung-html h1{font-family:G7;font-size:1000%;margin:1em auto;text-align:center;text-shadow:0 0 16px #000}@media(max-width:767px){.fung-html h1{font-size:4em;margin:2em auto}}.fung-html h2{margin-bottom:2em;text-align:center}.fung-html::-webkit-scrollbar-thumb{background-color:aqua}*,:after,:before{box-sizing:border-box}body{background-color:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;margin:0}@media(min-width:1280px){body{font-size:1.5em}}a{color:aqua;outline:none;text-decoration:none}a:hover{color:#f0f}a:not(.btn){position:relative}a:not(.btn):after{background:#f0f;content:"";height:1px;left:0;opacity:0;position:absolute;top:100%;-webkit-transform:translateY(.6em);transform:translateY(.6em);transition:opacity .3s,-webkit-transform .3s;transition:opacity .3s,transform .3s;transition:opacity .3s,transform .3s,-webkit-transform .3s;width:100%}a:not(.btn):hover:after{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}h2,h3,h4,li,p{font-weight:lighter}h1{font-family:Milletun,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:3em}@media(min-width:768px){h1{font-size:4em}}h3{font-variant:small-caps}h4{font-style:italic}section{margin:auto}@media(min-width:768px){section{width:66.666%}}@media(max-width:767px){section{margin:16px}}ul{list-style-type:square}blockquote{border-left:8px solid #fff;font-style:italic;margin:0;padding:0 32px}blockquote p{margin:0}iframe{border:none;max-width:100%}.vertical-timeline-element-content{text-align:center}.vertical-timeline-element-content .vertical-timeline-element-date{text-align:left}@media(max-width:767px){.vertical-timeline-element-content .vertical-timeline-element-date{float:none}}.vertical-timeline-element-content a:after{content:none}.vertical-timeline-element-content h2{color:#fff;font-size:1.8em}.btn{border-radius:4px;display:block;padding:10px 20px;text-align:center}.btn+.btn{margin-top:1em}.btn.btn-default,.btn.btn-source{border:2px solid aqua;transition:border-color .4s,color .4s}.btn.btn-default:hover,.btn.btn-source:hover{border-color:#f0f}.btn.btn-primary{background:aqua;color:#000;transition:background .4s}.btn.btn-primary:hover{background:#f0f}.btn.btn-source{overflow:hidden;position:relative}.btn.btn-source .source-lines{-webkit-animation:scroll 4s linear infinite;animation:scroll 4s linear infinite;position:absolute;width:100%}.btn.btn-source .source-lines>*{background:rgba(0,255,255,.2);height:12px;margin-bottom:8px;transition:background .4s}.btn.btn-source:hover .source-lines>*{background:rgba(255,0,255,.4)}.scroll-to-top{border-left:8px solid aqua;border-top:8px solid aqua;bottom:32px;cursor:pointer;height:48px;position:fixed;right:64px;-webkit-transform:translateX(128px) rotate(45deg);transform:translateX(128px) rotate(45deg);transition:-webkit-transform .4s cubic-bezier(.5,0,.2,1.1);transition:transform .4s cubic-bezier(.5,0,.2,1.1);transition:transform .4s cubic-bezier(.5,0,.2,1.1),-webkit-transform .4s cubic-bezier(.5,0,.2,1.1);width:48px}@media(max-width:767px){.scroll-to-top{display:none}}.scroll-to-top:hover{border-color:#f0f}.scroll-to-top.in{-webkit-transform:translateX(0) rotate(45deg);transform:translateX(0) rotate(45deg)}.container{padding:20px}.parallax-container{-webkit-animation:background-fade-in .6s 6s 1 backwards;animation:background-fade-in .6s 6s 1 backwards}.parallax-container,html{background-color:aqua;scrollbar-color:aqua #000}.parallax-container::-webkit-scrollbar,html::-webkit-scrollbar{background-color:#000}.parallax-container::-webkit-scrollbar-thumb,html::-webkit-scrollbar-thumb{background-color:inherit}.parallax-container::-webkit-scrollbar-thumb:horizontal:hover,.parallax-container::-webkit-scrollbar-thumb:vertical:hover,html::-webkit-scrollbar-thumb:horizontal:hover,html::-webkit-scrollbar-thumb:vertical:hover{background-color:#0cc}.parallax-container::-webkit-scrollbar-thumb:horizontal:active,.parallax-container::-webkit-scrollbar-thumb:vertical:active,html::-webkit-scrollbar-thumb:horizontal:active,html::-webkit-scrollbar-thumb:vertical:active{background-color:#099}.block-center{margin:auto;text-align:center;width:100%}.text-right{text-align:right}@media(max-width:767px){.mobile-hidden{display:none}}@media(min-width:768px){.mobile-visible{display:none}}.load-spinner{border:4px solid aqua;height:80%;left:10%;position:absolute;right:10%;top:10%;z-index:-100}.load-spinner:after,.load-spinner:before{background-color:#000;content:"";height:300%;position:absolute;width:150%}.load-spinner:before{-webkit-animation:spin .6s linear 433ms 1;animation:spin .6s linear 433ms 1;left:-100%;top:-100%;-webkit-transform-origin:right;transform-origin:right}.load-spinner:after{-webkit-animation:spin .6s linear .4s 1;animation:spin .6s linear .4s 1;right:-100%;top:-100%;-webkit-transform-origin:left;transform-origin:left}.intro-header{align-items:center;display:flex;flex-grow:1;width:100%}.intro-header>h1{-webkit-animation:background-scroll 1s linear infinite,fade-in 4s linear 1s 1 backwards;animation:background-scroll 1s linear infinite,fade-in 4s linear 1s 1 backwards;background-attachment:fixed;-webkit-background-clip:text;background-clip:text;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UqDhYs4pChOlkQFekoVSyChdJWaNXB5NIvaGJIUlwcBdeCgx+LVQcXZ10dXAVB8APE0clJ0UVK/F9SaBHjwXE/3t173L0DhGaNqWbPBKBqlpFJJsR8YUUMviKACIYQR1Bipp7KLuTgOb7u4ePrXYxneZ/7c/QrRZMBPpF4lumGRbxOPLNp6Zz3icOsIinE58TjBl2Q+JHrsstvnMsOCzwzbOQyc8RhYrHcxXIXs4qhEk8TRxVVo3wh77LCeYuzWquz9j35C0NFbTnLdZojSGIRKaQhQkYdVdRgIUarRoqJDO0nPPzDjj9NLplcVTByzGMDKiTHD/4Hv7s1S1OTblIoAQRebPtjFAjuAq2GbX8f23brBPA/A1dax7/RBOKfpDc6WvQIGNgGLq47mrwHXO4AkSddMiRH8tMUSiXg/Yy+qQAM3gJ9q25v7X2cPgA56mrpBjg4BMbKlL3m8e7e7t7+PdPu7weu6XK/AQO+EgAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+YFGQA1Fr/dsr0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAN0lEQVRIx+3WsQkAAAgDwej+O2vnBhGU/8ruwCqSoVLNkTIHAAAAAAAAAADwBYjZkZdaHb/2FzVHFAwvKrhP1QAAAABJRU5ErkJggg==);background-size:32px 32px;color:transparent;flex-grow:1;font-family:Milletun;font-size:18vw;margin:0;position:relative;text-align:center}@media(max-width:767px){.intro-header>h1{font-size:100vw;margin-left:4vw;margin-top:-10vh}}@media(-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:2dppx){.intro-header>h1{-webkit-animation:background-scroll 2s linear infinite,fade-in 4s linear 1s 1 backwards;animation:background-scroll 2s linear infinite,fade-in 4s linear 1s 1 backwards;background-size:16px 16px}}.intro-header>h1>span{-webkit-animation:fade-in-cyan-shadow 1s linear 5s 1 backwards;animation:fade-in-cyan-shadow 1s linear 5s 1 backwards;left:0;position:absolute;right:0;text-shadow:1px 1px #0ff,2px 2px #0ff,3px 3px #0ff,4px 4px #0ff;z-index:-1}.page{align-items:center;display:flex;flex-direction:column;justify-content:center}.scroll-indicator{-webkit-animation:scroll-indicator-move 2s ease-in-out 6s infinite backwards;animation:scroll-indicator-move 2s ease-in-out 6s infinite backwards;background-color:#fff;height:10vh;margin-bottom:10vh;width:2px}.background-parallelogram{background-image:linear-gradient(0,#303,transparent);height:75%;-webkit-transform:translateY(15%) skew(0deg,5deg);transform:translateY(15%) skew(0deg,5deg);width:100%}.background-parallelogram.background-parallelogram-alt{background-image:linear-gradient(180deg,#033,transparent);-webkit-transform:translateY(15%) skew(0deg,-5deg);transform:translateY(15%) skew(0deg,-5deg)}.background-hatch{background-attachment:fixed;background-image:linear-gradient(180deg,#000,rgba(0,0,0,.75) 512px,rgba(0,0,0,.75)),url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UqDhYs4pChOlkQFekoVSyChdJWaNXB5NIvaGJIUlwcBdeCgx+LVQcXZ10dXAVB8APE0clJ0UVK/F9SaBHjwXE/3t173L0DhGaNqWbPBKBqlpFJJsR8YUUMviKACIYQR1Bipp7KLuTgOb7u4ePrXYxneZ/7c/QrRZMBPpF4lumGRbxOPLNp6Zz3icOsIinE58TjBl2Q+JHrsstvnMsOCzwzbOQyc8RhYrHcxXIXs4qhEk8TRxVVo3wh77LCeYuzWquz9j35C0NFbTnLdZojSGIRKaQhQkYdVdRgIUarRoqJDO0nPPzDjj9NLplcVTByzGMDKiTHD/4Hv7s1S1OTblIoAQRebPtjFAjuAq2GbX8f23brBPA/A1dax7/RBOKfpDc6WvQIGNgGLq47mrwHXO4AkSddMiRH8tMUSiXg/Yy+qQAM3gJ9q25v7X2cPgA56mrpBjg4BMbKlL3m8e7e7t7+PdPu7weu6XK/AQO+EgAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+YFGQA1Fr/dsr0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAN0lEQVRIx+3WsQkAAAgDwej+O2vnBhGU/8ruwCqSoVLNkTIHAAAAAAAAAADwBYjZkZdaHb/2FzVHFAwvKrhP1QAAAABJRU5ErkJggg==);height:9999px;width:100%;z-index:-200}.background-title{-webkit-text-fill-color:#000;-webkit-text-stroke:2px hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.1);color:#000;font-size:24vw;font-variant:small-caps;text-shadow:.3vw .3vw hsla(0,0%,100%,.2)}@media(min-width:768px){.up-down{-webkit-animation:up-down 6s ease-in-out infinite alternate;animation:up-down 6s ease-in-out infinite alternate}}.text-small{font-size:50%}.anagram-container{-webkit-animation:fade-in 1s linear 5s 1 backwards;animation:fade-in 1s linear 5s 1 backwards;color:hsla(0,0%,100%,.5);font-size:3vw;font-weight:lighter;text-align:center}@media(max-width:767px){.anagram-container{font-size:7vw}}.anagram-container .anagram-swap{color:hsla(0,0%,100%,.4)}code[class*=language-],pre[class*=language-]{word-wrap:normal;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.75em;-webkit-hyphens:none;hyphens:none;line-height:1;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='rgba(255,255,255,.1)'%3E%3Cpolygon points='0 50 50 0 0 0'/%3E%3Cpolygon points='0 100 50 100 100 50 100 0'/%3E%3C/svg%3E");background-size:1em 1em;margin:.5em 0;overflow:auto;padding:1em 2em}code[class*=language-]{background:#000;box-shadow:-.3em 0 0 .3em #000,.3em 0 0 .3em #000;color:#fff}:not(pre)>code[class*=language-]{border-radius:.3em;box-shadow:none;padding:.2em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#aaa}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#0cf}.token.attr-name,.token.builtin,.token.char,.token.selector,.token.string{color:#ff0}.language-css .token.string,.token.entity,.token.inserted,.token.operator,.token.url,.token.variable{color:#9acd32}.token.atrule,.token.attr-value,.token.keyword{color:#ff1493}.token.important,.token.regex{color:orange}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}pre.diff-highlight.diff-highlight>code .token.deleted:not(.prefix),pre>code.diff-highlight.diff-highlight .token.deleted:not(.prefix){background-color:rgba(255,0,0,.3);display:inline}pre.diff-highlight.diff-highlight>code .token.inserted:not(.prefix),pre>code.diff-highlight.diff-highlight .token.inserted:not(.prefix){background-color:rgba(0,255,128,.3);display:inline}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=2c6fd6d7fd2739211afefd7eea0a8384" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=2c6fd6d7fd2739211afefd7eea0a8384"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main class="container"><section><div class="block-center"><h1>Useful Powershell scripts</h1></div><h3>Table of contents</h3><ul><li><a href="#outlook-signatures">Autogenerate Outlook signatures</a></li><li><a href="#fix-sharepoint">Repair Sharepoint apps after theme change</a></li></ul><br/><div id="outlook-signatures"><h2>Autogenerate Outlook signatures</h2><p>This script will generate signatures in Outlook based on a template .docx. It will log all signature updates to a single server, so you can track rollout and updates</p><p>To use this script, you must place the template .docx file in the same location as the script (can be run from a GPO). Microsoft Word must be installed on the target machine, which should be the case if Outlook is installed.</p><p>Template replacement format is <!-- -->[<!-- -->Title<!-- -->]<!-- --> which will be replaced with the same value within Active Directory, eg. SharePoint Designer</p><div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token comment">#!/usr/local/bin/pwsh</span>
<span class="token comment">&lt;#
    .SYNOPSIS
    Script to set Outlook 2010/2013 e-mail signature using Active Directory information

    .DESCRIPTION
    This script will set the Outlook 2010/2013 e-mail signature on the local client using Active Directory information.
    The template is created with a Word document, where images can be inserted and AD values can be provided.

    Author: George Paton
    Version 2.1
#&gt;</span>

<span class="token comment">###  Global Vars ###</span>
<span class="token comment">## Company Variables</span>
<span class="token variable">$COMPANY_LONG_NAME</span>  = <span class="token string">&quot;Upstream Production Solutions&quot;</span>
<span class="token variable">$COMPANY_SHORT_NAME</span> = <span class="token string">&quot;Upstream PS&quot;</span>
<span class="token variable">$COMPANY_INITIALS</span>   = <span class="token string">&quot;UPS&quot;</span>
<span class="token variable">$COMPANY_VAR_NAME</span>   = <span class="token string">&quot;upstreamps&quot;</span>
<span class="token variable">$COMPANY_EMAIL_EXT</span>  = <span class="token string">&quot;@UpstreamPS.com&quot;</span>
<span class="token variable">$COMPANY_EMAIL_ENC</span>  = <span class="token string">&quot;_upstreamps_com&quot;</span>

<span class="token comment">### Logging Variables</span>
<span class="token variable">$LOG_FOLDER</span> = <span class="token string">&quot;\\Log-Server\Log-Share\Logs\&quot;</span>
<span class="token variable">$SIGNATURE_LOG_FOLDER</span> = <span class="token string">&quot;Set-Outlook-Signature\&quot;</span>

<span class="token comment">## Signature Variables</span>
<span class="token comment"># Signature name as it shows in Outlook</span>
<span class="token variable">$SIGNATURE_COMPOSE_NAME</span> = <span class="token variable">$COMPANY_VAR_NAME</span>
<span class="token variable">$SIGNATURE_REPLY_NAME</span>   = <span class="token variable">$COMPANY_VAR_NAME</span> <span class="token operator">+</span> <span class="token string">&quot;-reply&quot;</span>

<span class="token comment"># Separate signatures for compose/reply emails</span>
<span class="token variable">$SIGNATURE_SEPARATE</span> = <span class="token boolean">$true</span>

<span class="token comment"># Signature template filenames</span>
<span class="token variable">$SIGNATURE_COMPOSE_TEMPLATE</span> = <span class="token string">&quot;template-compose.docx&quot;</span>
<span class="token variable">$SIGNATURE_REPLY_TEMPLATE</span>   = <span class="token string">&quot;template-reply.docx&quot;</span>

<span class="token variable">$SIGNATURE_FORCE</span>         = <span class="token boolean">$false</span>  <span class="token comment">#Set to $true if you don&#x27;t want the users to be able to change signature in Outlook</span>
<span class="token variable">$SIGNATURE_FORCE_THEME</span>   = <span class="token boolean">$true</span>   <span class="token comment">#Set to $true to force Outlook default message theme within registry - ONLY IN Office 2013</span>
<span class="token variable">$SIGNATURE_MARK_COMMENTS</span> = <span class="token boolean">$true</span>   <span class="token comment">#Enable marking comments in emails with initials eg. [GP] - ONLY IN Office 2013</span>

<span class="token comment"># Default email compose and reply styling</span>
<span class="token comment"># Colour is in BGR format, not RGB</span>
<span class="token variable">$SIGNATURE_COMPOSE_FONT</span>  = <span class="token string">&quot;Calibri&quot;</span>
<span class="token variable">$SIGNATURE_COMPOSE_SIZE</span>  = 11
<span class="token variable">$SIGNATURE_COMPOSE_COLOR</span> = 0x5c3405

<span class="token variable">$SIGNATURE_REPLY_FONT</span>    = <span class="token variable">$SIGNATURE_COMPOSE_FONT</span>
<span class="token variable">$SIGNATURE_REPLY_SIZE</span>    = <span class="token variable">$SIGNATURE_COMPOSE_SIZE</span>
<span class="token variable">$SIGNATURE_REPLY_COLOR</span>   = <span class="token variable">$SIGNATURE_COMPOSE_COLOR</span>

<span class="token comment"># Maximum amount of days to elapse before autorenewing signature</span>
<span class="token variable">$SIGNATURE_MAX_AGE</span>       = 60

<span class="token comment"># Specify which lines to remove from completed template to handle blank fields in AD</span>
<span class="token comment"># This is an ARRAY LITERAL, please read:</span>
<span class="token comment"># * http://blogs.msdn.com/b/powershell/archive/2007/01/23/array-literals-in-powershell.aspx</span>
<span class="token comment"># ORDER MATTERS, Items higher up will be evaluated first</span>
<span class="token comment"># ^? matches any character, in this case, a newline character (so if an entire line is removed,</span>
<span class="token comment"># the newline is also removed, which ensures no weird blank lines show up)</span>
<span class="token variable">$SIGNATURE_TEMPLATE_BLANKS</span> =
    <span class="token string">&quot;a: [StreetAddress], [l] [st] [postalCode]^?&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;d: [TelephoneNumber] | r: [HomePhone] | m: [Mobile]^?&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;d: [TelephoneNumber] | r: [HomePhone] | &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;| r: [HomePhone] | m: [Mobile]&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;| m: [Mobile]&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;d: [TelephoneNumber] | &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;r: [HomePhone] | &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;[l] &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;[st] &quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;[postalCode]&quot;</span>
<span class="token comment">### /Global Vars ###</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$SIGNATURE_SEPARATE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$SIGNATURE_REPLY_NAME</span> = <span class="token variable">$SIGNATURE_COMPOSE_NAME</span>
<span class="token punctuation">}</span>

<span class="token comment"># Stop execution on unhandled errors</span>
<span class="token variable">$ErrorActionPreference</span> = <span class="token string">&quot;Stop&quot;</span>

<span class="token comment"># Environment variables</span>
<span class="token variable">$appData</span> = <span class="token punctuation">(</span><span class="token function">Get-Item</span> env:appdata<span class="token punctuation">)</span><span class="token punctuation">.</span>value
<span class="token variable">$signaturePath</span> = <span class="token string">&quot;\Microsoft\Signatures&quot;</span>
<span class="token variable">$localSignaturePath</span> = <span class="token variable">$appData</span> <span class="token operator">+</span> <span class="token variable">$signaturePath</span>

<span class="token comment"># Check signature path, and create if necessary</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span><span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>Path <span class="token variable">$localSignaturePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">New-Item</span> <span class="token variable">$localSignaturePath</span> <span class="token operator">-</span><span class="token function">Type</span> Directory
<span class="token punctuation">}</span>

<span class="token comment"># Logging</span>
<span class="token variable">$logPath</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\set_outlook_signature.log&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token variable">$logPath</span><span class="token punctuation">)</span> <span class="token operator">-or</span> <span class="token punctuation">(</span><span class="token function">Get-Item</span> <span class="token variable">$logPath</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length <span class="token operator">-gt</span> 100kb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">New-Item</span> <span class="token variable">$logPath</span> <span class="token operator">-</span><span class="token function">type</span> file <span class="token operator">-</span>force
<span class="token punctuation">}</span>
<span class="token function">Start-Transcript</span> <span class="token operator">-</span>path <span class="token variable">$logPath</span> <span class="token operator">-</span>Append

<span class="token comment"># Get Active Directory information for current user</span>
<span class="token variable">$username</span> = <span class="token variable">$env</span>:username
<span class="token variable">$filter</span> = <span class="token string">&quot;(&amp;(objectCategory=User)(samAccountName=<span class="token variable">$username</span>))&quot;</span>
<span class="token variable">$searcher</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>DirectoryServices<span class="token punctuation">.</span>DirectorySearcher
<span class="token variable">$searcher</span><span class="token punctuation">.</span><span class="token keyword">Filter</span> = <span class="token variable">$filter</span>
<span class="token variable">$ADUserPath</span> = <span class="token variable">$searcher</span><span class="token punctuation">.</span>FindOne<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">$ADUser</span> = <span class="token variable">$ADUserPath</span><span class="token punctuation">.</span>GetDirectoryEntry<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">### Timestamping - lets not run this more than we need to</span>
<span class="token comment"># Get last run timestamp</span>
<span class="token variable">$timestampPath</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\set_outlook_signature_timestamp.txt&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token variable">$timestampPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># If no timestamp is found, the script hasn&#x27;t run</span>
    <span class="token comment"># So lets set last run date to the very distant past</span>
    <span class="token variable">$epoch</span> = <span class="token function">Get-Date</span> <span class="token operator">-</span>Year 1970
    <span class="token function">New-Item</span> <span class="token variable">$timestampPath</span> <span class="token operator">-</span><span class="token function">type</span> file
    <span class="token function">Add-Content</span> <span class="token variable">$timestampPath</span> <span class="token variable">$epoch</span><span class="token punctuation">.</span>ToFileTimeUtc<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token variable">$timestamp</span> = <span class="token namespace">[DateTime]</span>::FromFileTimeUtc<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">Get-Content</span> <span class="token variable">$timestampPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token variable">$currentTime</span> = <span class="token punctuation">(</span><span class="token function">Get-Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ToUniversalTime<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Get time since the last run of this script</span>
<span class="token variable">$timeSinceLastRun</span> = <span class="token variable">$currentTime</span><span class="token punctuation">.</span>Subtract<span class="token punctuation">(</span><span class="token variable">$timestamp</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$timeSinceLastRun</span><span class="token punctuation">.</span>TotalDays <span class="token operator">-lt</span> <span class="token variable">$SIGNATURE_MAX_AGE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get time since last user modification</span>
    <span class="token variable">$userTimestamp</span> = <span class="token variable">$ADUser</span><span class="token punctuation">.</span>whenChanged<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
    <span class="token variable">$timeSinceLastUserChange</span> = <span class="token variable">$userTimestamp</span><span class="token punctuation">.</span>Subtract<span class="token punctuation">(</span><span class="token variable">$timestamp</span><span class="token punctuation">)</span>

    <span class="token comment"># Get time since last template change</span>
    <span class="token variable">$composeTimestamp</span> = <span class="token punctuation">(</span><span class="token function">Get-Item</span> <span class="token variable">$SIGNATURE_COMPOSE_TEMPLATE</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LastWriteTimeUtc
    <span class="token variable">$replyTimestamp</span> = <span class="token punctuation">(</span><span class="token function">Get-Item</span> <span class="token variable">$SIGNATURE_REPLY_TEMPLATE</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LastWriteTimeUtc
    <span class="token variable">$timeSinceLastComposeChange</span> = <span class="token variable">$composeTimestamp</span><span class="token punctuation">.</span>Subtract<span class="token punctuation">(</span><span class="token variable">$timestamp</span><span class="token punctuation">)</span>
    <span class="token variable">$timeSinceLastReplyChange</span> = <span class="token variable">$replyTimestamp</span><span class="token punctuation">.</span>Subtract<span class="token punctuation">(</span><span class="token variable">$timestamp</span><span class="token punctuation">)</span>

    <span class="token variable">$changeDetected</span> = <span class="token boolean">$false</span>

    <span class="token comment"># Positive seconds means the timestamp is older</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$timeSinceLastUserChange</span><span class="token punctuation">.</span>TotalSeconds <span class="token operator">-gt</span> 0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;User has been modified, renewing signature&quot;</span>
        <span class="token variable">$changeDetected</span> = <span class="token boolean">$true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$timeSinceLastComposeChange</span><span class="token punctuation">.</span>TotalSeconds <span class="token operator">-gt</span> 0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Compose template has been modified, renewing signature&quot;</span>
        <span class="token variable">$changeDetected</span> = <span class="token boolean">$true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$timeSinceLastReplyChange</span><span class="token punctuation">.</span>TotalSeconds <span class="token operator">-gt</span> 0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Reply template has been modified, renewing signature&quot;</span>
        <span class="token variable">$changeDetected</span> = <span class="token boolean">$true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$changeDetected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;No changes detected, exiting...&quot;</span>
        <span class="token function">Stop-Transcript</span>
        <span class="token function">Copy-Item</span> <span class="token variable">$logPath</span> <span class="token operator">-</span>Destination <span class="token punctuation">(</span><span class="token variable">$LOG_FOLDER</span> <span class="token operator">+</span> <span class="token variable">$SIGNATURE_LOG_FOLDER</span> <span class="token operator">+</span> <span class="token string">&quot;signature-&quot;</span> <span class="token operator">+</span> <span class="token variable">$username</span> <span class="token operator">+</span> <span class="token string">&quot;.log&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">exit</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Signature is old, lets renew it&quot;</span>
<span class="token punctuation">}</span>


<span class="token comment"># Load word.application enums</span>
<span class="token namespace">[System.Reflection.Assembly]</span>::LoadWithPartialName<span class="token punctuation">(</span><span class="token string">&quot;Microsoft.Office.Interop.Word&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">Out-Null</span>

<span class="token comment"># Text manipulation settings</span>
<span class="token variable">$replaceAll</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdReplace]</span><span class="token punctuation">,</span> <span class="token string">&quot;wdReplaceAll&quot;</span><span class="token punctuation">)</span>
<span class="token variable">$matchCase</span> = <span class="token boolean">$false</span>
<span class="token variable">$matchWholeWord</span> = <span class="token boolean">$true</span>
<span class="token variable">$matchWildcards</span> = <span class="token boolean">$false</span>
<span class="token variable">$matchSoundsLike</span> = <span class="token boolean">$false</span>
<span class="token variable">$matchAllWordForms</span> = <span class="token boolean">$false</span>
<span class="token variable">$forward</span> = <span class="token boolean">$true</span>
<span class="token variable">$wrap</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdFindWrap]</span><span class="token punctuation">,</span> <span class="token string">&quot;wdFindContinue&quot;</span><span class="token punctuation">)</span>
<span class="token variable">$format</span> = <span class="token boolean">$true</span>

<span class="token comment"># Create instance of Office Word</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$MSWord</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>ComObject word<span class="token punctuation">.</span>application
    <span class="token function">Write-Host</span> <span class="token string">&quot;Word version is: &quot;</span> <span class="token variable">$MSWord</span><span class="token punctuation">.</span>BuildFull
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
    <span class="token function">Write-Host</span> <span class="token string">&quot;Could not load Word, checking for office install&quot;</span>

    <span class="token variable">$comObject</span> = <span class="token function">Get-ChildItem</span> HKLM:\Software\Classes <span class="token operator">-</span>ea 0 <span class="token punctuation">|</span> <span class="token function">Where-Object</span> <span class="token punctuation">{</span> <span class="token variable">$_</span><span class="token punctuation">.</span>PSChildName <span class="token operator">-eq</span> <span class="token string">&#x27;Word.Application&#x27;</span> <span class="token operator">-and</span> <span class="token punctuation">(</span><span class="token function">Get-ItemProperty</span> <span class="token string">&quot;<span class="token function">$<span class="token punctuation">(</span>_<span class="token punctuation">.</span>PSPath<span class="token punctuation">)</span></span>\CLSID&quot;</span> <span class="token operator">-</span>ea 0<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$comObject</span> <span class="token operator">-ne</span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token string">&quot;C:\program files\Microsoft Office 15\ClientX86&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Write-Host</span> <span class="token string">&quot;Repairing Office 32 bit&quot;</span>
            <span class="token comment"># CMD Prompt style command for background office repair</span>
            &amp; <span class="token string">&quot;C:\program files\Microsoft Office 15\ClientX86\OfficeClickToRun.exe&quot;</span> scenario=Repair DisplayLevel=False
        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token string">&quot;C:\program files\Microsoft Office 15\ClientX64&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Write-Host</span> <span class="token string">&quot;Repairing Office 64 bit&quot;</span>
            <span class="token comment"># CMD Prompt style command for background office repair</span>
            &amp; <span class="token string">&quot;C:\program files\Microsoft Office 15\ClientX64\OfficeClickToRun.exe&quot;</span> scenario=Repair DisplayLevel=False
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">Write-Host</span> <span class="token string">&quot;OfficeClickToRun not found, repair failed&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Word COM object not found, please check office is installed&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Finish transcription to log file</span>
    <span class="token function">Stop-Transcript</span>

    <span class="token comment"># Send log file to Logs folder</span>
    <span class="token function">Copy-Item</span> <span class="token variable">$logPath</span> <span class="token operator">-</span>Destination <span class="token punctuation">(</span><span class="token variable">$LOG_FOLDER</span> <span class="token operator">+</span> <span class="token variable">$SIGNATURE_LOG_FOLDER</span> <span class="token operator">+</span> <span class="token string">&quot;signature-&quot;</span> <span class="token operator">+</span> <span class="token variable">$username</span> <span class="token operator">+</span> <span class="token string">&quot;.log&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">exit</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check for pass by reference or not</span>
<span class="token comment"># This is a disgusting hack, thanks Microsoft...</span>
<span class="token variable">$isPassByRef</span> = <span class="token boolean">$true</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$MSWord</span><span class="token punctuation">.</span>Repeat<span class="token punctuation">(</span><span class="token namespace">[ref]</span>0<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token variable">$isPassByRef</span> = <span class="token boolean">$false</span>
<span class="token punctuation">}</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Pass by ref: &quot;</span> <span class="token variable">$isPassByRef</span>


<span class="token keyword">function</span> ReplaceText<span class="token punctuation">(</span><span class="token variable">$find</span><span class="token punctuation">,</span> <span class="token variable">$replace</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$currentDocument</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$isMatched</span> = <span class="token variable">$MSWord</span><span class="token punctuation">.</span>Selection<span class="token punctuation">.</span>Find<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span>
            <span class="token variable">$find</span><span class="token punctuation">,</span>
            <span class="token variable">$matchCase</span><span class="token punctuation">,</span>
            <span class="token variable">$matchWholeWord</span><span class="token punctuation">,</span>
            <span class="token variable">$matchWildcards</span><span class="token punctuation">,</span>
            <span class="token variable">$matchSoundsLike</span><span class="token punctuation">,</span>
            <span class="token variable">$matchAllWordForms</span><span class="token punctuation">,</span>
            <span class="token variable">$forward</span><span class="token punctuation">,</span>
            <span class="token variable">$wrap</span><span class="token punctuation">,</span>
            <span class="token variable">$format</span><span class="token punctuation">,</span>
            <span class="token variable">$replace</span><span class="token punctuation">,</span>
            <span class="token variable">$replaceAll</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isMatched</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Write-Host</span> <span class="token variable">$find</span> <span class="token variable">$replace</span>
            <span class="token keyword">return</span> <span class="token boolean">$true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Replace failed for:&quot;</span> <span class="token variable">$find</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">$false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> FindText<span class="token punctuation">(</span><span class="token variable">$find</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$currentDocument</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$MSWord</span><span class="token punctuation">.</span>Selection<span class="token punctuation">.</span>Find<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span>
        <span class="token variable">$find</span><span class="token punctuation">,</span>
        <span class="token variable">$matchCase</span><span class="token punctuation">,</span>
        <span class="token variable">$matchWholeWord</span><span class="token punctuation">,</span>
        <span class="token variable">$matchWildcards</span><span class="token punctuation">,</span>
        <span class="token variable">$matchSoundsLike</span><span class="token punctuation">,</span>
        <span class="token variable">$matchAllWordForms</span><span class="token punctuation">,</span>
        <span class="token variable">$forward</span><span class="token punctuation">,</span>
        <span class="token variable">$wrap</span><span class="token punctuation">,</span>
        <span class="token variable">$format</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">$true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">$false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> RemoveText<span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ReplaceText <span class="token variable">$text</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> SetSignature<span class="token punctuation">(</span><span class="token variable">$aTemplateFile</span><span class="token punctuation">,</span> <span class="token variable">$aTemplateName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token function">Write-Host</span> <span class="token string">&quot;Copying Signature file: <span class="token variable">$aTemplateFile</span>&quot;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">Copy-Item</span> <span class="token variable">$aTemplateFile</span> <span class="token variable">$localSignaturePath</span> <span class="token operator">-</span>Recurse <span class="token operator">-</span>Force
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Couldn&#x27;t load template, error: &quot;</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
        <span class="token keyword">return</span> <span class="token boolean">$false</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Insert variables from Active Directory into file</span>
    <span class="token variable">$fullPath</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">+</span> <span class="token variable">$aTemplateFile</span>
    <span class="token variable">$currentDocument</span> = <span class="token variable">$MSWord</span><span class="token punctuation">.</span>Documents<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token variable">$fullPath</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">)</span> <span class="token comment">#filename, show convert file, open read-only, add to recent files</span>

    <span class="token function">Write-Host</span> <span class="token string">&quot;Setting signature values for <span class="token variable">$aTemplateName</span>&quot;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$property</span> in <span class="token variable">$ADUser</span><span class="token punctuation">.</span>psobject<span class="token punctuation">.</span>properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$propertyName</span> = <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> <span class="token variable">$property</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$property</span><span class="token punctuation">.</span>value <span class="token operator">-ne</span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ReplaceText <span class="token variable">$propertyName</span> <span class="token variable">$property</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span> &gt; <span class="token variable">$null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment"># Set mail hyperlink</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$hyperlink</span> in <span class="token variable">$MSWord</span><span class="token punctuation">.</span>ActiveDocument<span class="token punctuation">.</span>Hyperlinks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$hyperlink</span><span class="token punctuation">.</span>Name <span class="token operator">-eq</span> <span class="token string">&quot;mailto:[mail]&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$mailtoLink</span> = <span class="token string">&quot;mailto:&quot;</span> <span class="token operator">+</span> <span class="token variable">$ADUser</span><span class="token punctuation">.</span>mail
            <span class="token variable">$hyperlink</span><span class="token punctuation">.</span>Address = <span class="token variable">$mailtoLink</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Remove empty lines if necessary</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Removing empty template lines&quot;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$line</span> in <span class="token variable">$SIGNATURE_TEMPLATE_BLANKS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        RemoveText <span class="token variable">$line</span> &gt; <span class="token variable">$null</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># If any blanks failed to be removed, don&#x27;t save</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FindText <span class="token string">&quot;[&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Blank template lines found, saving failed, Please check Powershell-Vars.ps1 string removal array&quot;</span>

        <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">$false</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Save new message signature</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Saving signature <span class="token variable">$aTemplateName</span>&quot;</span>

    <span class="token comment"># Save HTML</span>
    <span class="token variable">$saveFormat</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdSaveFormat]</span><span class="token punctuation">,</span> <span class="token string">&quot;wdFormatHTML&quot;</span><span class="token punctuation">)</span>
    <span class="token variable">$path</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">+</span> <span class="token variable">$aTemplateName</span> <span class="token operator">+</span> <span class="token string">&quot;.htm&quot;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">#filename, file format, lock comments, password, add to recent files</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isPassByRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token namespace">[ref]</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Failed to save as HTML, error: &quot;</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
        <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">$false</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Save RTF</span>
    <span class="token variable">$saveFormat</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdSaveFormat]</span><span class="token punctuation">,</span> <span class="token string">&quot;wdFormatRTF&quot;</span><span class="token punctuation">)</span>
    <span class="token variable">$path</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">+</span> <span class="token variable">$aTemplateName</span> <span class="token operator">+</span> <span class="token string">&quot;.rtf&quot;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isPassByRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token namespace">[ref]</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Failed to save as RTF, error: &quot;</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
        <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">$false</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Save TXT</span>
    <span class="token variable">$saveFormat</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdSaveFormat]</span><span class="token punctuation">,</span> <span class="token string">&quot;wdFormatText&quot;</span><span class="token punctuation">)</span>
    <span class="token variable">$path</span> = <span class="token variable">$localSignaturePath</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">+</span> <span class="token variable">$aTemplateName</span> <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isPassByRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token namespace">[ref]</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token namespace">[ref]</span><span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>SaveAs<span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$saveFormat</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">$false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Failed to save as TXT, error: &quot;</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
        <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">$false</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$currentDocument</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">$true</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> ExitGracefully<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$saveOptions</span> = <span class="token namespace">[Enum]</span>::Parse<span class="token punctuation">(</span><span class="token namespace">[Microsoft.Office.Interop.Word.WdSaveOptions]</span><span class="token punctuation">,</span>  <span class="token string">&quot;wdDoNotSaveChanges&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isPassByRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$MSWord</span><span class="token punctuation">.</span>Quit<span class="token punctuation">(</span><span class="token namespace">[ref]</span><span class="token variable">$saveOptions</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$MSWord</span><span class="token punctuation">.</span>Quit<span class="token punctuation">(</span><span class="token variable">$saveOptions</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Finish transcription to log file</span>
    <span class="token function">Stop-Transcript</span>

    <span class="token comment"># Send log file to Logs folder</span>
    <span class="token function">Copy-Item</span> <span class="token variable">$logPath</span> <span class="token operator">-</span>Destination <span class="token punctuation">(</span><span class="token variable">$LOG_FOLDER</span> <span class="token operator">+</span> <span class="token variable">$SIGNATURE_LOG_FOLDER</span> <span class="token operator">+</span> <span class="token string">&quot;signature-&quot;</span> <span class="token operator">+</span> <span class="token variable">$username</span> <span class="token operator">+</span> <span class="token string">&quot;.log&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">Write-Host</span> <span class="token string">&quot;Waiting 2 seconds for AD object&quot;</span>
<span class="token function">Start-Sleep</span> 2

<span class="token comment"># Run signature filler</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span>SetSignature <span class="token variable">$SIGNATURE_COMPOSE_TEMPLATE</span> <span class="token variable">$SIGNATURE_COMPOSE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Compose Template creation failed, exiting&quot;</span>
    ExitGracefully
    <span class="token keyword">exit</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SIGNATURE_SEPARATE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span>SetSignature <span class="token variable">$SIGNATURE_REPLY_TEMPLATE</span> <span class="token variable">$SIGNATURE_REPLY_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Reply Template creation failed, exiting&quot;</span>
        ExitGracefully
        <span class="token keyword">exit</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># All Office versions</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Adding signature to Office&quot;</span>
<span class="token variable">$emailOptions</span> = <span class="token variable">$MSWord</span><span class="token punctuation">.</span>EmailOptions
<span class="token variable">$emailSignature</span> = <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>EmailSignature
<span class="token variable">$emailCompose</span> = <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>ComposeStyle
<span class="token variable">$emailReply</span> = <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>ReplyStyle

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$emailSignature</span><span class="token punctuation">.</span>NewMessageSignature = <span class="token variable">$SIGNATURE_COMPOSE_NAME</span>
    <span class="token variable">$emailSignature</span><span class="token punctuation">.</span>ReplyMessageSignature = <span class="token variable">$SIGNATURE_REPLY_NAME</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Setting default signature failed, exiting&quot;</span>
    <span class="token function">Write-Host</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message
    ExitGracefully
<span class="token punctuation">}</span>


<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SIGNATURE_FORCE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Office 2010</span>
    <span class="token keyword">If</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> HKCU:Software\Microsoft\Office\14<span class="token punctuation">.</span>0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Forcing set signature for Outlook 2010&quot;</span>
        <span class="token function">New-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\14.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;ReplySignature&quot;</span> <span class="token operator">-</span>Value <span class="token variable">$SIGNATURE_REPLY_NAME</span> <span class="token operator">-</span>PropertyType <span class="token string">&quot;String&quot;</span> <span class="token operator">-</span>Force
        <span class="token function">New-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\14.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;NewSignature&quot;</span> <span class="token operator">-</span>Value <span class="token variable">$SIGNATURE_COMPOSE_NAME</span> <span class="token operator">-</span>PropertyType <span class="token string">&quot;String&quot;</span> <span class="token operator">-</span>Force
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Office 2010 not installed, 2010 signatures skipped&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Office 2013</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> HKCU:Software\Microsoft\Office\15<span class="token punctuation">.</span>0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Forcing set signature for Outlook 2013&quot;</span>
        <span class="token function">New-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\15.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;ReplySignature&quot;</span> <span class="token operator">-</span>Value <span class="token variable">$SIGNATURE_REPLY_NAME</span> <span class="token operator">-</span>PropertyType <span class="token string">&quot;String&quot;</span> <span class="token operator">-</span>Force
        <span class="token function">New-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\15.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;NewSignature&quot;</span> <span class="token operator">-</span>Value <span class="token variable">$SIGNATURE_COMPOSE_NAME</span> <span class="token operator">-</span>PropertyType <span class="token string">&quot;String&quot;</span> <span class="token operator">-</span>Force
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Office 2013 not installed, 2013 signatures skipped&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment"># Office 2010</span>
    <span class="token keyword">If</span> <span class="token punctuation">(</span><span class="token function">Test-RegistryValue</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\14.0\Common\MailSettings&#x27;</span> <span class="token string">&quot;NewSignature&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Removing signature enforcement for Outlook 2010&quot;</span>
        <span class="token function">Remove-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\14.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;ReplySignature&quot;</span> <span class="token operator">-</span>Force
        <span class="token function">Remove-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\14.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;NewSignature&quot;</span> <span class="token operator">-</span>Force
    <span class="token punctuation">}</span>

    <span class="token comment"># Office 2013</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-RegistryValue</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\15.0\Common\MailSettings&#x27;</span> <span class="token string">&quot;NewSignature&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Removing signature enforcement for Outlook 2013&quot;</span>
        <span class="token function">Remove-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\15.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;ReplySignature&quot;</span> <span class="token operator">-</span>Force
        <span class="token function">Remove-ItemProperty</span> HKCU:<span class="token string">&#x27;\Software\Microsoft\Office\15.0\Common\MailSettings&#x27;</span> <span class="token operator">-</span>Name <span class="token string">&quot;NewSignature&quot;</span> <span class="token operator">-</span>Force
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SIGNATURE_FORCE_THEME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Themes are enforced, setting font for compose and reply&quot;</span>

    <span class="token variable">$emailCompose</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Name = <span class="token variable">$SIGNATURE_COMPOSE_FONT</span>
    <span class="token variable">$emailCompose</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Size = <span class="token variable">$SIGNATURE_COMPOSE_SIZE</span>
    <span class="token variable">$emailCompose</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Color = <span class="token variable">$SIGNATURE_COMPOSE_COLOR</span>

    <span class="token variable">$emailReply</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Name = <span class="token variable">$SIGNATURE_REPLY_FONT</span>
    <span class="token variable">$emailReply</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Size = <span class="token variable">$SIGNATURE_REPLY_SIZE</span>
    <span class="token variable">$emailReply</span><span class="token punctuation">.</span>Font<span class="token punctuation">.</span>Color = <span class="token variable">$SIGNATURE_REPLY_COLOR</span>

    <span class="token comment"># Ensure no custom themes are used</span>
    <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>ThemeName = <span class="token string">&quot;none&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SIGNATURE_MARK_COMMENTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Email comments are marked, setting mark as user initials&quot;</span>

    <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>MarkCommentsWith = <span class="token variable">$MSWord</span><span class="token punctuation">.</span>UserInitials
    <span class="token variable">$emailOptions</span><span class="token punctuation">.</span>MarkComments = <span class="token boolean">$true</span>
<span class="token punctuation">}</span>

<span class="token comment"># Timestamp the last run time</span>
<span class="token variable">$newTime</span> = <span class="token punctuation">(</span><span class="token function">Get-Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ToFileTimeUtc<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">New-Item</span> <span class="token variable">$timestampPath</span> <span class="token operator">-</span><span class="token function">type</span> file <span class="token operator">-</span>force
<span class="token function">Add-Content</span> <span class="token variable">$timestampPath</span> <span class="token variable">$newTime</span>

ExitGracefully</code></pre></div><hr/></div><div id="fix-sharepoint"><h2>Repair Sharepoint apps after theme change</h2><p>On SharePoint, if you change the theme of an App on the App Catalog, or change a theme of a site that contains an Apps, all the Apps in the App Catalog will fail catastrophically.</p><p>This script is a quick fixme that requires zero configuration, just upload it to the SharePoint server and run it to repair the App Catalog entirely.</p><div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token comment">#!/usr/local/bin/pwsh</span>
<span class="token comment"># Written by George Paton</span>
<span class="token comment">## This little number automatically fixes that annoying app breaking bug to do with themes</span>
<span class="token comment">## If an app is complaining about being unable to open a file, run me on the SP server</span>


<span class="token comment"># Add the sharepoint snapin to the current session</span>
<span class="token function">Add-PSSnapin</span> Microsoft<span class="token punctuation">.</span>Sharepoint<span class="token punctuation">.</span>Powershell

<span class="token comment"># Get the app prefix</span>
<span class="token variable">$prefix</span> = <span class="token function">Get-SPAppSiteSubscriptionName</span>
<span class="token comment"># Use the app prefix to get all app urls</span>
<span class="token variable">$allappurls</span> = <span class="token function">Get-SPSite</span> <span class="token punctuation">|</span> <span class="token function">Get-SPWeb</span> <span class="token operator">-</span>Limit All <span class="token punctuation">|</span> where <span class="token punctuation">{</span><span class="token variable">$_</span><span class="token punctuation">.</span>url <span class="token operator">-like</span> <span class="token string">&quot;http://<span class="token variable">$prefix</span>*&quot;</span><span class="token punctuation">}</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$app</span> in <span class="token variable">$allappurls</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment"># Loop through all apps within the default site with the app prefix of $prefix</span>
	<span class="token variable">$name</span> = <span class="token variable">$app</span><span class="token punctuation">.</span>name
	<span class="token variable">$app</span><span class="token punctuation">.</span>CustomMasterUrl = <span class="token string">&quot;/<span class="token variable">$name</span>/_catalogs/masterpage/app.master&quot;</span>
	<span class="token variable">$app</span><span class="token punctuation">.</span>MasterUrl = <span class="token string">&quot;/<span class="token variable">$name</span>/_catalogs/masterpage/app.master&quot;</span>
	<span class="token variable">$app</span><span class="token punctuation">.</span>Update<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">echo</span> <span class="token string">&quot;Updating masterpage for <span class="token variable">$app</span>&quot;</span>
<span class="token punctuation">}</span></code></pre></div><br/></div></section><div class="block-center"><a href="/">Go home</a></div><br/><div class="scroll-to-top"></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/powershell/";window.___webpackCompilationHash="9c8be71728478f20c1b2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-391c044c748d2f88820d.js"],"app":["/app-0c8db6a77f2ef0d8cf53.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-f48bed6f3af81a553a58.js"],"component---src-pages-answers-tsx":["/component---src-pages-answers-tsx-322934939bd8c3e7455c.js"],"component---src-pages-betrfomt-tsx":["/component---src-pages-betrfomt-tsx-e8a24bfde13f918ca230.js"],"component---src-pages-fung-tsx":["/component---src-pages-fung-tsx-5acf941f51f79cfd8e7a.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-3b392f679bb7e39ddd2f.js"],"component---src-pages-powershell-tsx":["/component---src-pages-powershell-tsx-e2e55b5c8f93f3105b54.js"]};/*]]>*/</script><script src="/polyfill-391c044c748d2f88820d.js" nomodule=""></script><script src="/app-0c8db6a77f2ef0d8cf53.js" async=""></script><script src="/framework-45e8d7f5b7ec897a339e.js" async=""></script><script src="/webpack-runtime-f2f073a0fdfe47872784.js" async=""></script></body></html>